"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StringSerializer = void 0;
const resolve_length_1 = require("./resolve-length");
const utils_1 = require("./utils");
/**
 * Serializes strings to/from bitstreams
 */
class StringSerializer {
    *read(reader, type, parent, field) {
        let length = (0, resolve_length_1.resolveLength)(field.length, parent, field);
        if (!reader.isAvailable(length * 8))
            yield { remaining: length * 8, contextHint: () => (0, utils_1.summarizeField)(field) };
        return reader.readStringSync(length, field.options.string);
    }
    write(writer, type, parent, field, value) {
        var _a, _b;
        let length;
        try {
            length = (0, resolve_length_1.resolveLength)(field.length, parent, field);
        }
        catch (e) {
            throw new Error(`Failed to resolve length of string via 'length' determinant: ${e.message}`);
        }
        writer.writeString(length, `${value}`, ((_b = (_a = field === null || field === void 0 ? void 0 : field.options) === null || _a === void 0 ? void 0 : _a.string) === null || _b === void 0 ? void 0 : _b.encoding) || 'utf-8');
    }
}
exports.StringSerializer = StringSerializer;
//# sourceMappingURL=string-serializer.js.map