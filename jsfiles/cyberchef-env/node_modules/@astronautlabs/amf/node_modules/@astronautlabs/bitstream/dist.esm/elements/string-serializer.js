import { resolveLength } from "./resolve-length";
import { summarizeField } from "./utils";
/**
 * Serializes strings to/from bitstreams
 */
export class StringSerializer {
    *read(reader, type, parent, field) {
        let length = resolveLength(field.length, parent, field);
        if (!reader.isAvailable(length * 8))
            yield { remaining: length * 8, contextHint: () => summarizeField(field) };
        return reader.readStringSync(length, field.options.string);
    }
    write(writer, type, parent, field, value) {
        var _a, _b;
        let length;
        try {
            length = resolveLength(field.length, parent, field);
        }
        catch (e) {
            throw new Error(`Failed to resolve length of string via 'length' determinant: ${e.message}`);
        }
        writer.writeString(length, `${value}`, ((_b = (_a = field === null || field === void 0 ? void 0 : field.options) === null || _a === void 0 ? void 0 : _a.string) === null || _b === void 0 ? void 0 : _b.encoding) || 'utf-8');
    }
}
//# sourceMappingURL=string-serializer.js.map