"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NumberSerializer = void 0;
const resolve_length_1 = require("./resolve-length");
const utils_1 = require("./utils");
/**
 * Serializes numbers to/from bitstreams
 */
class NumberSerializer {
    *read(reader, type, parent, field) {
        var _a, _b, _c;
        let length;
        try {
            length = (0, resolve_length_1.resolveLength)(field.length, parent, field);
        }
        catch (e) {
            throw new Error(`Failed to resolve length of number via 'length' determinant: ${e.message}`);
        }
        if (!reader.isAvailable(length))
            yield { remaining: length, contextHint: () => (0, utils_1.summarizeField)(field) };
        let format = (_c = (_b = (_a = field.options) === null || _a === void 0 ? void 0 : _a.number) === null || _b === void 0 ? void 0 : _b.format) !== null && _c !== void 0 ? _c : 'unsigned';
        if (format === 'unsigned')
            return reader.readSync(length);
        else if (format === 'signed')
            return reader.readSignedSync(length);
        else if (format === 'float')
            return reader.readFloatSync(length);
        else
            throw new TypeError(`Unsupported number format '${format}'`);
    }
    write(writer, type, instance, field, value) {
        var _a, _b, _c;
        if (value === undefined)
            value = 0;
        let length;
        try {
            length = (0, resolve_length_1.resolveLength)(field.length, instance, field);
        }
        catch (e) {
            throw new Error(`Failed to resolve length of number via 'length' determinant: ${e.message}`);
        }
        let format = (_c = (_b = (_a = field.options) === null || _a === void 0 ? void 0 : _a.number) === null || _b === void 0 ? void 0 : _b.format) !== null && _c !== void 0 ? _c : 'unsigned';
        if (format === 'unsigned')
            writer.write(length, value);
        else if (format === 'signed')
            writer.writeSigned(length, value);
        else if (format === 'float')
            writer.writeFloat(length, value);
        else
            throw new TypeError(`Unsupported number format '${format}'`);
    }
}
exports.NumberSerializer = NumberSerializer;
//# sourceMappingURL=number-serializer.js.map