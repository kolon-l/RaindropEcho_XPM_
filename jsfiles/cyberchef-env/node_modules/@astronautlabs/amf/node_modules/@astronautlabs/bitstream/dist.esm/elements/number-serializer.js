import { resolveLength } from "./resolve-length";
import { summarizeField } from "./utils";
/**
 * Serializes numbers to/from bitstreams
 */
export class NumberSerializer {
    *read(reader, type, parent, field) {
        var _a, _b, _c;
        let length;
        try {
            length = resolveLength(field.length, parent, field);
        }
        catch (e) {
            throw new Error(`Failed to resolve length of number via 'length' determinant: ${e.message}`);
        }
        if (!reader.isAvailable(length))
            yield { remaining: length, contextHint: () => summarizeField(field) };
        let format = (_c = (_b = (_a = field.options) === null || _a === void 0 ? void 0 : _a.number) === null || _b === void 0 ? void 0 : _b.format) !== null && _c !== void 0 ? _c : 'unsigned';
        if (format === 'unsigned')
            return reader.readSync(length);
        else if (format === 'signed')
            return reader.readSignedSync(length);
        else if (format === 'float')
            return reader.readFloatSync(length);
        else
            throw new TypeError(`Unsupported number format '${format}'`);
    }
    write(writer, type, instance, field, value) {
        var _a, _b, _c;
        if (value === undefined)
            value = 0;
        let length;
        try {
            length = resolveLength(field.length, instance, field);
        }
        catch (e) {
            throw new Error(`Failed to resolve length of number via 'length' determinant: ${e.message}`);
        }
        let format = (_c = (_b = (_a = field.options) === null || _a === void 0 ? void 0 : _a.number) === null || _b === void 0 ? void 0 : _b.format) !== null && _c !== void 0 ? _c : 'unsigned';
        if (format === 'unsigned')
            writer.write(length, value);
        else if (format === 'signed')
            writer.writeSigned(length, value);
        else if (format === 'float')
            writer.writeFloat(length, value);
        else
            throw new TypeError(`Unsupported number format '${format}'`);
    }
}
//# sourceMappingURL=number-serializer.js.map